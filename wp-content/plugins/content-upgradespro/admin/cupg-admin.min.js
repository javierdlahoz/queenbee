var $j=jQuery.noConflict();$j(document).ready(function(){function t(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")}function e(t){var e=$j(t).val();"-2"==e?c($j("#cupg_content_custom_url_container")):a($j("#cupg_content_custom_url_container")),"already_sub"===e||"thank_you"===e?c($j(t).next(".cupg_settings_block_note")):a($j(t).next(".cupg_settings_block_note"))}function n(t,e){return t?void t.open():(t=window.wp.media(e),t.open(),t)}function c(t){t.hasClass("cupg_hidden")&&t.removeClass("cupg_hidden")}function a(t){t.hasClass("cupg_hidden")||t.addClass("cupg_hidden")}function i(t){"-2"!==t.val()?a(t.siblings(".cupg_custom_page_container")):c(t.siblings(".cupg_custom_page_container"))}function o(){var t=s.text;t=t.split("."),s.text2=t[0],s.text="",t.length>1&&(s.text2+=".",t=t.splice(1),s.text=t.join(".").trim())}function u(t,e){$j(".fancybox_text").text(t),$j("#cupg_fb_text").val(t),$j(".fancybox_text2").text(e),$j("#cupg_fb_text2").val(e)}function p(){var t="none"===s.cu_id?"":" linked_cu="+s.cu_id,e=r.indexOf("icon")>-1&&s.icon===!1?" icon=false":"",n=r.indexOf("background")>-1&&s.background?' background="'+s.background+'"':"",c=r.indexOf("action1")>-1&&s.action1&&s.action1!==l.action1?' action1="'+s.action1+'"':"",a=r.indexOf("action2")>-1&&s.action2&&s.action2!==l.action2?' action2="'+s.action2+'"':"",i=r.indexOf("text2")>-1&&s.text2?' text2="'+s.text2+'"':"",o=r.indexOf("align")>-1&&s.align&&s.align!==l.align?' align="'+s.align+'"':"";$j("#cupg_code").val("[fancy_box id="+s.id+t+n+e+c+a+i+o+"]"+s.text+"[/fancy_box]")}function _(){for(var t=["align","background","icon","action1","action2","text2"],e=[$j("#cupg_align").val(),$j("#cupg_color").val(),$j("#cupg_icon").is(":checked"),$j("#cupg_action1").val(),$j("#cupg_action2").val(),$j("#cupg_fb_text2").val()],n=0;n<t.length;n++)-1===r.indexOf(t[n])?(a($j(".cupg_"+t[n])),d&&"text2"===t[n]&&(s.text=(s.text2+" "+s.text).trim(),u(s.text,""),d=!1),s[t[n]]=e[n]):(c($j(".cupg_"+t[n])),"text2"===t[n]&&(o(),u(s.text,s.text2),d=!0))}$j(".cupg_one_click_selectable").on("click",function(){$j(this).select()}),$j("#coupg_header").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_header").html(t($j(this).val()))}),$j("#coupg_description").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_description").html(t($j(this).val()))}),$j("#coupg_default_email_text").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_email_input_wrapper .cupg_email_input").attr("placeholder",$j(this).val())}),$j("#coupg_default_name_text").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_email_input_wrapper .cupg_name_input").attr("placeholder",$j(this).val())}),$j("#coupg_button_text").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_submit_button").html($j(this).val())}),$j("#coupg_privacy_statement").bind("keyup mouseup",function(){$j(".cupg_popup .cupg_privacy span").html($j(this).val())}),$j("#coupg_pwdb").on("change",function(){$j(this).is(":checked")?a($j(".cupg_poweredby")):c($j(".cupg_poweredby"))}),$j("#coupg_theme").change(function(){var t={action:"cupg_change_theme_preview",cupg_id:$j(this).attr("data-id"),cupg_theme:$j(this).val()};$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:t,success:function(t){$j("#cupg_popup_preview").html(t.html)}})}),e($j("#coupg_upg_location_page")),$j("#coupg_upg_location_page").change(function(){e($j(this))}),$j("#cupg_add_ab_header").on("click",function(t){t.preventDefault();var e=$j(".cupg_ab_headline.cupg_hidden").length;0!==e&&(1===e&&$j(this).removeClass("button-primary").addClass("button-disabled"),$j(".cupg_ab_headline.cupg_hidden").first().removeClass("cupg_hidden"))}),$j(".cupg_delete_ab_header").on("click",function(){$j(this).closest(".cupg_ab_headline").addClass("cupg_hidden"),$j(this).closest(".cupg_ab_headline").find("textarea").val(""),$j("#cupg_add_ab_header").hasClass("button-disabled")&&$j("#cupg_add_ab_header").removeClass("button-disabled").addClass("button-primary")}),$j("#cupg_message_div").bind("DOMSubtreeModified",function(){var t=$j("#cupg_message_div").html();$j("#coupg_message_text").val(t)});var g=$j("#cupg_popup_preview");$j("#cupg_custom_image").on("click",function(t){t.preventDefault();var e,c,a={title:"Select new image for pop-up",button:{text:"Use This Image"},multiple:!1};e=n(e,a),e.on("select",function(){var t=e.state().get("selection").first().toJSON();c=t.url,e.close(),"undefined"!=typeof c&&(g.find(".cupg_figure").attr("style","").css("background-image","url("+c+")"),g.find(".cupg_popup_wrapper").hasClass("no_image")&&g.find(".cupg_popup_wrapper").removeClass("no_image"),$j("#coupg_popup_image").val(c))})}),$j("#cupg_default_image").on("click",function(t){t.preventDefault(),g.find(".cupg_figure").attr("style",""),g.find(".cupg_popup_wrapper").hasClass("no_image")&&g.find(".cupg_popup_wrapper").removeClass("no_image"),$j("#coupg_popup_image").val("")}),$j("#cupg_no_image").on("click",function(t){t.preventDefault(),g.find(".cupg_figure").attr("style","").css("background-image","none"),g.find(".cupg_popup_wrapper").hasClass("no_image")||g.find(".cupg_popup_wrapper").addClass("no_image"),$j("#coupg_popup_image").val("none")}),$j("#cupg_bonus_file").on("click",function(t){t.preventDefault();var e,i,o={title:"Upload bonus file",button:{text:"Use This File as Bonus"},multiple:!1};e=n(e,o),e.on("select",function(){var t=e.state().get("selection").first().toJSON();i=t.url,e.close(),"undefined"!=typeof i?($j("#coupg_bonus_file_url").text(i),$j('input[name="coupg_bonus_file_url"]').val(i),c($j("option.cupg_hidden"))):""!==$j("#coupg_bonus_file_url").text()&&a($j("option.cupg_hidden"))})}),$j("#coupg_add_to_depot").on("change",function(){$j(this).is(":checked")?c($j(".cupg_bonus_depot_settings")):a($j(".cupg_bonus_depot_settings"))}),$j("#cupg_activate_plugin").on("click",function(){var t={action:"cupg_activate",cupg_code:$j("#cupg_key").val(),cupg_domain:$j("#cupg_domain").val(),cupg_email:$j("#cupg_email").val()};$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:t,success:function(t){1==t.status?(alert("Plugin was successfully activated."),window.location=t.link):0==t.status&&alert("Something went wrong.\nError: "+t.error)}})}),$j("#cupg_get_lists").on("click",function(){var t={action:"cupg_get_lists",apikey:$j("#cupg_api_key").val(),appkey:$j("#cupg_app_key").val()};$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:t,success:function(t){1==t.status?t.listnum>0?alert("Successfully grabbed "+t.listnum+" "+(1==t.listnum?"list":"lists")+"\nList Names:\n"+t.listnames):alert("No email lists found"):0==t.status&&alert("Something went wrong. Error messsage:\n"+t.error)}})}),$j("#cupg_client").change(function(){$j(".cupg_settings_main").hide(),$j(".cupg_keys").hide()}),$j("#cupg_double_optin").change(function(){var t=$j(".cupg_double_optin_pages"),e=$j(".cupg_disable_double_optin_pages");$j(this).is(":checked")?(a(t),c(e)):(c(t),a(e))}),$j("#cupg_send_email").change(function(){var t=$j(".cupg_email_settings");$j(this).is(":checked")?c(t):a(t)}),$j("#cupg_confirm_sub").change(function(){i($j(this))}),$j("#cupg_already_sub").change(function(){i($j(this))}),$j("#cupg_thank_you").change(function(){i($j(this))}),$j("#cupg_sitewide_popup_toggle").change(function(){$j(this).is(":checked")?c($j(".cupg_sitewidepopup_settings")):a($j(".cupg_sitewidepopup_settings"))}),$j("#cupg_sitewide_popup_display_type").change(function(){"delay"===$j(this).val()?c($j(".cupg_popup_time_delay")):a($j(".cupg_popup_time_delay"))});var s={id:1,text:$j("#cupg_fb_text").val(),text2:$j("#cupg_fb_text2").val(),action1:$j("#cupg_action1").val(),action2:$j("#cupg_action2").val(),background:"",icon:!0,align:$j("#cupg_align").val(),cu_id:"none"},l={action1:$j("#cupg_action1").val(),action2:$j("#cupg_action2").val(),align:$j("#cupg_align").val()},r=["align"],d=!1;if(top.tinymce&&top.tinymce.activeEditor){var j=top.tinymce.activeEditor.windowManager.getParams();s.text=j.editor.selection.getContent(),p(),u(s.text,""),$j("#fb-code .hndle.ui-sortable-handle span").text("INSERT"),$j("#cupg_insert_code").on("click",function(){var t="";if("fancy_box"===$j("#cupg_shortcode").val())t=$j("#cupg_code").val();else{var e="none"===s.cu_id?"":" id="+s.cu_id;t="[content_upgrade"+e+"]"+s.text+"[/content_upgrade]"}j.editor.selection.setContent(t),j.editor.windowManager.close()}),$j("#cupg_shortcode").on("change",function(){"fancy_box"===$j(this).val()?($j(".cupg_shortcode_toggleable").show(),$j("#fb-preview").show(),a($j(".cupg_shortcode_reverse_toggleable"))):($j(".cupg_shortcode_toggleable").hide(),$j("#fb-preview").hide(),c($j(".cupg_shortcode_reverse_toggleable")))})}if("function"==typeof $j(".cupg_colorpicker").wpColorPicker){$j(".cupg_colorpicker").wpColorPicker();var $=new MutationObserver(function(t){t.forEach(function(t){if("style"===t.attributeName){var e=$j(".wp-color-result").attr("style");e?s.background=e.split("color: ")[1].slice(0,-1):s.background="",10!=s.id?$j(".cupg_fancybox").css("background",s.background):$j(".fancybox_action1").css("background",s.background),p()}})});$.observe(document.querySelector(".wp-color-result"),{attributes:!0,attributeFilter:["style"]})}$j("#cupg_type").change(function(){s.id=$j(this).val();var t={action:"cupg_change_fb_preview",cupg_fb:s};$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:t,success:function(t){$j(".cupg_preview_wrapper").html(t.html.replace(/\\"/g,'"')),r=t.properties,_(),p()}})}),$j("#cupg_icon").on("change",function(){var t=$j(".cupg_fancybox"),e=t.hasClass("no_icon");$j(this).is(":checked")&&e&&(t.removeClass("no_icon"),s.icon=!0),$j(this).is(":checked")||e||(t.addClass("no_icon"),s.icon=!1),p()}),$j("#cupg_fb_text").on("input",function(){s.text=t($j(this).val()),$j(".fancybox_text").html(s.text),p()}),$j("#cupg_fb_text2").on("input",function(){s.text2=t($j(this).val()),$j(".fancybox_text2").html(s.text2),p()}),$j("#cupg_action1").on("input",function(){s.action1=$j(this).val(),$j(".fancybox_action1").text(s.action1),p()}),$j("#cupg_action2").on("input",function(){s.action2=$j(this).val(),$j(".fancybox_action2").text(s.action2),p()}),$j("#cupg_align").on("change",function(){s.align=$j(this).val(),$j(".fancybox_text").css("text-align",$j(this).val()),p()}),$j("#cupg_cu_selector").on("change",function(){s.cu_id=$j(this).val(),p()})});