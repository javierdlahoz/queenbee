var $j=jQuery.noConflict();$j(document).ready(function(){function e(e){$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:e})}function t(e){for(var t=e+"=",p=document.cookie.split(";"),n=0;n<p.length;n++){for(var i=p[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t)){var o=i.substring(t.length,i.length);if(o.length>0)return o=decodeURIComponent(o),JSON.parse(o)}}return""}function p(e,t,p){var n=new Date;n.setTime(n.getTime()+24*p*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+i}function n(p,n){p.show();var i=t(Cupg_Session.cookies.session);"undefined"!=typeof i.name&&p.find(".cupg_name_input").val(unescape(i.name)),"undefined"!=typeof i.email&&p.find(".cupg_email_input").val(i.email);var o={action:"cupg_popups",popup_type:n,upgrade_id:p.attr("data-id"),header_id:p.find(".cupg_header").attr("data-id")};e(o),c("off")}function i(e){var n=t(Cupg_Session.cookies.counter),i=365,o=+Cupg_Session.popup.interval;0!=Cupg_Session.popup.max_times_shown&&(n>=Cupg_Session.popup.max_times_shown||e)&&(i=-1,o=365),p(Cupg_Session.cookies.counter,+n+1,i),p(Cupg_Session.cookies.blocker,!0,o)}function o(e){e.clientY%15===0&&(o.prev=e.clientY),e.clientY<=45&&o.prev&&o.prev>e.clientY&&(n(e.data,"popups_popup"),i(!1),$j(document).off("mousemove",o))}function u(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)}function a(e,t,p,n){e.addClass("cupg_action"),e.attr("disabled","disabled");var o=e.closest(".cupg_popup"),u={action:"cupg_subscriptions",popup_type:n,upgrade_id:o.attr("data-id"),header_id:o.find(".cupg_header").attr("data-id"),email:t};"undefined"!=typeof p&&(u.subscriber_name=p),$j.ajax({type:"post",dataType:"json",url:Cupg_Ajax.ajaxurl,data:u,success:function(t){"subscriptions_popup"===n&&i(!0),"success"==t.status?"none"!==t.link&&(window.location=t.link):alert("Something went wrong.\nError code: "+t.error),s(e)},error:function(t){s(e)}})}function s(e){var t=e.find(".cupg_submit_button");t.hasClass("cupg_action")&&(t.removeAttr("disabled"),t.removeClass("cupg_action")),e.fadeOut(),c("on")}function c(e){var t=$j("html").hasClass("cupg_no_scroll");"off"!==e||t||$j("html").addClass("cupg_no_scroll"),"on"===e&&t&&$j("html").removeClass("cupg_no_scroll")}var r=[];if($j(".cupg_link_container").each(function(){var e=$j(this).attr("data-id");-1===r.indexOf(e)&&r.push(e)}),r.length>0){var _={action:"cupg_visits",upgrade_ids:r};e(_)}$j(".cupg_link_container > a").on("click",function(e){e.preventDefault();var t=$j(this).parent().attr("data-id"),p=$j(".cupg_regular_popup.cupg_upgrade_box_"+t);n($j(p),"popups")}),$j(".cupg_link_container.cupg_fancybox").on("click",function(e){e.preventDefault();var t=$j(this).attr("data-id"),p=$j(".cupg_regular_popup.cupg_upgrade_box_"+t);n($j(p),"popups")}),$j(".cupg_sitewide_popup").each(function(){var e=$j(this);"exit"!==Cupg_Session.popup.display_type?setTimeout(function(){n(e,"popups_popup"),i(!1)},1e3*Cupg_Session.popup.delay,e):$j(document).on("mousemove",e,o)}),$j(".cupg_submit_button").on("click",function(e){e.preventDefault();var t=$j(this).closest(".cupg_popup_wrapper").find(".cupg_name_input").val();if("undefined"!=typeof t&&0===t.length)return void alert("Please enter your name");var p=$j(this).closest(".cupg_popup_wrapper").find(".cupg_email_input").val();return u(p)?void($j(this).hasClass("cupg_sitewide_popup_submit")?a($j(this),p,t,"subscriptions_popup"):a($j(this),p,t,"subscriptions")):void alert("Invalid E-mail")}),$j(document).keypress(function(e){13==e.which&&$j(".cupg_popup").is(":visible")&&$j(".cupg_popup:visible").find(".cupg_submit_button").click()}),$j(".cupg_close_button").on("click",function(){s($j(this).closest(".cupg_popup"))})});